{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alessandro/Downloads/wedding-landing/app/api/gifts/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\n\nconst DATA_PATH = path.join(process.cwd(), \"data\", \"gifts.json\")\nconst UPLOAD_DIR = path.join(process.cwd(), \"public\", \"uploads\", \"gifts\")\n\nasync function ensureFile() {\n  try {\n    await fs.access(DATA_PATH)\n  } catch {\n    await fs.mkdir(path.dirname(DATA_PATH), { recursive: true })\n    await fs.writeFile(DATA_PATH, \"[]\", \"utf-8\")\n  }\n}\n\nexport async function GET() {\n  await ensureFile()\n  const buf = await fs.readFile(DATA_PATH, \"utf-8\")\n  const data = JSON.parse(buf)\n  return NextResponse.json(data)\n}\n\nexport async function POST(request: Request) {\n  await ensureFile()\n  const contentType = request.headers.get(\"content-type\") || \"\"\n  const buf = await fs.readFile(DATA_PATH, \"utf-8\")\n  const data = JSON.parse(buf)\n  const nextId = data.reduce((max: number, g: any) => Math.max(max, Number(g.id) || 0), 0) + 1\n\n  async function saveUploadedFile(file: File) {\n    const arrayBuffer = await file.arrayBuffer()\n    const buffer = Buffer.from(arrayBuffer)\n    await fs.mkdir(UPLOAD_DIR, { recursive: true })\n    const safeName = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\")\n    const filename = `${Date.now()}-${safeName}`\n    const filePath = path.join(UPLOAD_DIR, filename)\n    await fs.writeFile(filePath, buffer)\n    return `/uploads/gifts/${filename}`\n  }\n\n  if (contentType.includes(\"multipart/form-data\")) {\n    const form = await request.formData()\n    const name = String(form.get(\"name\") || \"\")\n    const category = String(form.get(\"category\") || \"\")\n    const imageFile = form.get(\"image\") as File | null\n    let imagePath = \"\"\n    if (imageFile && typeof imageFile === \"object\" && imageFile.size) {\n      imagePath = await saveUploadedFile(imageFile)\n    }\n    const entry = {\n      id: nextId,\n      name,\n      image: imagePath,\n      category,\n      claimed: false,\n    }\n    data.push(entry)\n    await fs.writeFile(DATA_PATH, JSON.stringify(data, null, 2), \"utf-8\")\n    return NextResponse.json(entry, { status: 201 })\n  } else {\n    const body = await request.json()\n    const entry = {\n      id: nextId,\n      name: String(body?.name || \"\"),\n      image: String(body?.image || \"\"),\n      category: String(body?.category || \"\"),\n      claimed: Boolean(body?.claimed || false),\n      claimedBy: body?.claimedBy ? String(body.claimedBy) : undefined,\n      claimedByPhoto: body?.claimedByPhoto ? String(body.claimedByPhoto) : undefined,\n    }\n    data.push(entry)\n    await fs.writeFile(DATA_PATH, JSON.stringify(data, null, 2), \"utf-8\")\n    return NextResponse.json(entry, { status: 201 })\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AACnD,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW;AAEjE,eAAe;IACb,IAAI;QACF,MAAM,yGAAE,CAAC,MAAM,CAAC;IAClB,EAAE,OAAM;QACN,MAAM,yGAAE,CAAC,KAAK,CAAC,4GAAI,CAAC,OAAO,CAAC,YAAY;YAAE,WAAW;QAAK;QAC1D,MAAM,yGAAE,CAAC,SAAS,CAAC,WAAW,MAAM;IACtC;AACF;AAEO,eAAe;IACpB,MAAM;IACN,MAAM,MAAM,MAAM,yGAAE,CAAC,QAAQ,CAAC,WAAW;IACzC,MAAM,OAAO,KAAK,KAAK,CAAC;IACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM;IACN,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAC3D,MAAM,MAAM,MAAM,yGAAE,CAAC,QAAQ,CAAC,WAAW;IACzC,MAAM,OAAO,KAAK,KAAK,CAAC;IACxB,MAAM,SAAS,KAAK,MAAM,CAAC,CAAC,KAAa,IAAW,KAAK,GAAG,CAAC,KAAK,OAAO,EAAE,EAAE,KAAK,IAAI,KAAK;IAE3F,eAAe,iBAAiB,IAAU;QACxC,MAAM,cAAc,MAAM,KAAK,WAAW;QAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,yGAAE,CAAC,KAAK,CAAC,YAAY;YAAE,WAAW;QAAK;QAC7C,MAAM,WAAW,KAAK,IAAI,CAAC,OAAO,CAAC,oBAAoB;QACvD,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,UAAU;QAC5C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QACvC,MAAM,yGAAE,CAAC,SAAS,CAAC,UAAU;QAC7B,OAAO,CAAC,eAAe,EAAE,UAAU;IACrC;IAEA,IAAI,YAAY,QAAQ,CAAC,wBAAwB;QAC/C,MAAM,OAAO,MAAM,QAAQ,QAAQ;QACnC,MAAM,OAAO,OAAO,KAAK,GAAG,CAAC,WAAW;QACxC,MAAM,WAAW,OAAO,KAAK,GAAG,CAAC,eAAe;QAChD,MAAM,YAAY,KAAK,GAAG,CAAC;QAC3B,IAAI,YAAY;QAChB,IAAI,aAAa,OAAO,cAAc,YAAY,UAAU,IAAI,EAAE;YAChE,YAAY,MAAM,iBAAiB;QACrC;QACA,MAAM,QAAQ;YACZ,IAAI;YACJ;YACA,OAAO;YACP;YACA,SAAS;QACX;QACA,KAAK,IAAI,CAAC;QACV,MAAM,yGAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;QAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD,OAAO;QACL,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,QAAQ;YACZ,IAAI;YACJ,MAAM,OAAO,MAAM,QAAQ;YAC3B,OAAO,OAAO,MAAM,SAAS;YAC7B,UAAU,OAAO,MAAM,YAAY;YACnC,SAAS,QAAQ,MAAM,WAAW;YAClC,WAAW,MAAM,YAAY,OAAO,KAAK,SAAS,IAAI;YACtD,gBAAgB,MAAM,iBAAiB,OAAO,KAAK,cAAc,IAAI;QACvE;QACA,KAAK,IAAI,CAAC;QACV,MAAM,yGAAE,CAAC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM,IAAI;QAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD;AACF","debugId":null}}]
}