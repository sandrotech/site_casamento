{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alessandro/Downloads/wedding-landing/app/api/gifts/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\n\nconst DATA_PATH = path.join(process.cwd(), \"data\", \"gifts.json\")\nconst UPLOAD_DIR = path.join(process.cwd(), \"public\", \"uploads\", \"gifts\")\n\nasync function readAll() {\n  try {\n    const buf = await fs.readFile(DATA_PATH, \"utf-8\")\n    return JSON.parse(buf)\n  } catch {\n    return []\n  }\n}\n\nasync function writeAll(items: any[]) {\n  await fs.mkdir(path.dirname(DATA_PATH), { recursive: true })\n  await fs.writeFile(DATA_PATH, JSON.stringify(items, null, 2), \"utf-8\")\n}\n\nexport async function PUT(request: Request, { params }: { params: { id: string } }) {\n  let raw = params?.id\n  if (!raw) {\n    try {\n      const url = new URL(request.url)\n      raw = url.pathname.split('/').filter(Boolean).pop() || ''\n    } catch {}\n  }\n  let id = parseInt(String(raw).replace(/[^0-9]/g, ''), 10)\n  const contentType = request.headers.get(\"content-type\") || \"\"\n  const items = await readAll()\n  const idx = items.findIndex((g: any) => Number(g.id) === id)\n  if (idx === -1) return NextResponse.json({ error: \"not_found\" }, { status: 404 })\n  if (contentType.includes(\"multipart/form-data\")) {\n    const form = await request.formData()\n    const patch: any = {}\n    if (form.has(\"name\")) patch.name = String(form.get(\"name\") || \"\")\n    if (form.has(\"claimed\")) patch.claimed = String(form.get(\"claimed\")) === \"true\"\n    if (form.has(\"claimedBy\")) patch.claimedBy = String(form.get(\"claimedBy\") || \"\")\n    const imageFile = form.get(\"image\") as File | null\n    if (imageFile && typeof imageFile === \"object\" && imageFile.size) {\n      await fs.mkdir(UPLOAD_DIR, { recursive: true })\n      const safeName = imageFile.name.replace(/[^a-zA-Z0-9._-]/g, \"_\")\n      const filename = `${Date.now()}-${safeName}`\n      const arrayBuffer = await imageFile.arrayBuffer()\n      const buffer = Buffer.from(arrayBuffer)\n      await fs.writeFile(path.join(UPLOAD_DIR, filename), buffer)\n      patch.image = `/uploads/gifts/${filename}`\n    }\n    const claimedByPhotoFile = form.get(\"claimedByPhoto\") as File | null\n    if (claimedByPhotoFile && typeof claimedByPhotoFile === \"object\" && claimedByPhotoFile.size) {\n      await fs.mkdir(UPLOAD_DIR, { recursive: true })\n      const safeName = claimedByPhotoFile.name.replace(/[^a-zA-Z0-9._-]/g, \"_\")\n      const filename = `${Date.now()}-${safeName}`\n      const arrayBuffer = await claimedByPhotoFile.arrayBuffer()\n      const buffer = Buffer.from(arrayBuffer)\n      await fs.writeFile(path.join(UPLOAD_DIR, filename), buffer)\n      patch.claimedByPhoto = `/uploads/gifts/${filename}`\n    }\n    items[idx] = { ...items[idx], ...patch, id }\n  } else {\n    const body = await request.json()\n    const next = { ...items[idx], ...body, id }\n    if (body && Object.prototype.hasOwnProperty.call(body, 'claimed') && body.claimed === false) {\n      delete next.claimedBy\n      delete next.claimedByPhoto\n    }\n    items[idx] = next\n  }\n  await writeAll(items)\n  return NextResponse.json(items[idx])\n}\n\nexport async function DELETE(_request: Request, { params }: { params: { id: string } }) {\n  const id = Number(params.id)\n  const items = await readAll()\n  const idx = items.findIndex((g: any) => Number(g.id) === id)\n  if (idx === -1) return NextResponse.json({ error: \"not_found\" }, { status: 404 })\n  if (items[idx]?.claimed) return NextResponse.json({ error: \"claimed\" }, { status: 409 })\n  items.splice(idx, 1)\n  await writeAll(items)\n  return NextResponse.json({ ok: true })\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}