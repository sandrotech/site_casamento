{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alessandro/Downloads/wedding-landing/app/api/supporters/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\n\nconst DATA_PATH = path.join(process.cwd(), \"data\", \"supporters.json\")\nconst UPLOAD_DIR = path.join(process.cwd(), \"public\", \"uploads\", \"supporters\")\n\nasync function ensureFile() {\n  try {\n    await fs.access(DATA_PATH)\n  } catch {\n    await fs.mkdir(path.dirname(DATA_PATH), { recursive: true })\n    await fs.writeFile(DATA_PATH, \"[]\", \"utf-8\")\n  }\n}\n\nasync function readAll() {\n  await ensureFile()\n  const buf = await fs.readFile(DATA_PATH, \"utf-8\")\n  try {\n    return JSON.parse(buf)\n  } catch {\n    return []\n  }\n}\n\nasync function writeAll(items: any[]) {\n  await fs.writeFile(DATA_PATH, JSON.stringify(items, null, 2), \"utf-8\")\n}\n\nexport async function GET() {\n  const items = await readAll()\n  return NextResponse.json(items)\n}\n\nexport async function POST(request: Request) {\n  const ct = request.headers.get(\"content-type\") || \"\"\n  const items = await readAll()\n  const nextId = items.reduce((m: number, it: any) => Math.max(m, Number(it.id) || 0), 0) + 1\n\n  async function saveFile(file: File, dir: string) {\n    await fs.mkdir(dir, { recursive: true })\n    const safe = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\")\n    const fname = `${Date.now()}-${safe}`\n    const ab = await file.arrayBuffer()\n    const buf = Buffer.from(ab)\n    const full = path.join(dir, fname)\n    await fs.writeFile(full, buf)\n    return fname\n  }\n\n  if (ct.includes(\"multipart/form-data\")) {\n    const form = await request.formData()\n    const name = String(form.get(\"supportName\") || form.get(\"name\") || \"\")\n    const photoFile = (form.get(\"supportPhoto\") || form.get(\"photo\")) as File | null\n    const receiptFile = (form.get(\"receipt\") || form.get(\"comprovante\")) as File | null\n    let photoPath = \"\"\n    let receiptPath = \"\"\n    if (photoFile && typeof photoFile === \"object\" && photoFile.size) {\n      const fname = await saveFile(photoFile, UPLOAD_DIR)\n      photoPath = `/uploads/supporters/${fname}`\n    }\n    if (receiptFile && typeof receiptFile === \"object\" && receiptFile.size) {\n      const fname = await saveFile(receiptFile, UPLOAD_DIR)\n      receiptPath = `/uploads/supporters/${fname}`\n    }\n    const entry = { id: nextId, name, photo: photoPath || undefined, receipt: receiptPath || undefined, createdAt: new Date().toISOString() }\n    items.push(entry)\n    await writeAll(items)\n    return NextResponse.json(entry, { status: 201 })\n  }\n\n  const body = await request.json().catch(() => ({}))\n  const entry = { id: nextId, name: String(body?.name || \"\"), photo: body?.photo ? String(body.photo) : undefined, receipt: body?.receipt ? String(body.receipt) : undefined, createdAt: new Date().toISOString() }\n  items.push(entry)\n  await writeAll(items)\n  return NextResponse.json(entry, { status: 201 })\n}"],"names":[],"mappings":"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","debugId":null}}]
}